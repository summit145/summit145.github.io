<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mobile FPS Full</title>
<style>
html,body{margin:0;padding:0;overflow:hidden;background:black;}
canvas{display:block;}
#ui{position:absolute;bottom:10px;left:10px;color:white;font-family:Arial;}
button{font-size:18px;padding:10px;margin:5px;}
</style>
</head>
<body>
<canvas id="c"></canvas>

<div id="ui">
  <button id="left">‚óÄ</button>
  <button id="right">‚ñ∂</button>
  <button id="forward">‚ñ≤</button>
  <button id="shoot">üî´</button>
  <button id="switch">üîÅ</button>
</div>

<script>
// ========== SETUP ==========
const canvas=document.getElementById("c");
const ctx=canvas.getContext("2d");
canvas.width=innerWidth;
canvas.height=innerHeight;

const map=[
"1111111111",
"1000000001",
"1000110001",
"1000000001",
"1000000001",
"1000010001",
"1000000001",
"1000020001",
"1000000001",
"1111111111"
];

let player={
  x:2.5,y:2.5,angle:0,
  health:100,
  weapons:[
    {name:"Pistol",ammo:20,damage:20,speed:1},
    {name:"Rifle",ammo:50,damage:10,speed:3},
    {name:"Shotgun",ammo:10,damage:40,speed:0.5}
  ],
  current:0
};

let enemies=[
  {x:6.5,y:6.5,health:30,type:"grunt"},
  {x:8.5,y:7.5,health:50,type:"soldier"}
];

let pickups=[
  {x:3.5,y:3.5,type:"ammo"},
  {x:7.5,y:2.5,type:"health"}
];

const FOV=Math.PI/3;
const RAYS=120;
const MAX=20;

// ========== AUDIO ==========
let shootAudio = new Audio("https://freesound.org/data/previews/320/320181_5260871-lq.mp3");
let hitAudio = new Audio("https://freesound.org/data/previews/256/256113_4486188-lq.mp3");

// ========== CORE FUNCTIONS ==========
function cast(angle){
  let sin=Math.sin(angle),cos=Math.cos(angle);
  for(let d=0;d<MAX;d+=0.05){
    let x=player.x+cos*d;
    let y=player.y+sin*d;
    if(map[Math.floor(y)][Math.floor(x)]=="1") return d;
  }
  return MAX;
}

function draw(){
  ctx.fillStyle="#000";
  ctx.fillRect(0,0,canvas.width,canvas.height);

  // sky & floor
  ctx.fillStyle="#222"; ctx.fillRect(0,0,canvas.width,canvas.height/2);
  ctx.fillStyle="#555"; ctx.fillRect(0,canvas.height/2,canvas.width,canvas.height/2);

  // walls
  for(let i=0;i<RAYS;i++){
    let a=player.angle-FOV/2+FOV*i/RAYS;
    let d=cast(a);
    let h=canvas.height/(d*0.8);
    ctx.fillStyle=`rgb(${200-d*10},${200-d*10},${200-d*10})`;
    ctx.fillRect(i*(canvas.width/RAYS),(canvas.height-h)/2,canvas.width/RAYS+1,h);
  }

  // draw gun sprite
  ctx.fillStyle="#111";
  ctx.fillRect(canvas.width/2-40,canvas.height-120,80,80);
  ctx.fillStyle="white";
  ctx.font="20px Arial";
  ctx.fillText("HP:"+player.health,20,30);
  let w=player.weapons[player.current];
  ctx.fillText(w.name+" Ammo:"+w.ammo,20,60);

  // draw enemies (dots for simplicity)
  ctx.fillStyle="red";
  for(let e of enemies){
    let dx=e.x-player.x;
    let dy=e.y-player.y;
    let dist=Math.sqrt(dx*dx+dy*dy);
    if(dist<10){ // simple proximity render
      let screenX=canvas.width/2+dx*20;
      let screenY=canvas.height/2+dy*20;
      ctx.beginPath();
      ctx.arc(screenX,screenY,10,0,2*Math.PI);
      ctx.fill();
    }
  }

  // draw pickups
  for(let p of pickups){
    ctx.fillStyle=p.type=="ammo"?"yellow":"green";
    let dx=p.x-player.x;
    let dy=p.y-player.y;
    let screenX=canvas.width/2+dx*20;
    let screenY=canvas.height/2+dy*20;
    ctx.beginPath();
    ctx.arc(screenX,screenY,8,0,2*Math.PI);
    ctx.fill();
  }
}

// ========== MOVEMENT ==========
function moveForward(){
  let nx=player.x+Math.cos(player.angle)*0.2;
  let ny=player.y+Math.sin(player.angle)*0.2;
  if(map[Math.floor(ny)][Math.floor(nx)]!="1"){player.x=nx;player.y=ny;}
}

// ========== SHOOT ==========
function shoot(){
  let w=player.weapons[player.current];
  if(w.ammo<=0) return;
  w.ammo--;
  shootAudio.currentTime=0; shootAudio.play();

  for(let e of enemies){
    let dx=e.x-player.x;
    let dy=e.y-player.y;
    let dist=Math.sqrt(dx*dx+dy*dy);
    let dir=Math.atan2(dy,dx);
    if(Math.abs(dir-player.angle)<0.3 && dist<5){
      e.health-=w.damage;
      hitAudio.currentTime=0; hitAudio.play();
    }
  }
  enemies=enemies.filter(e=>e.health>0);
}

// ========== SWITCH WEAPON ==========
function switchWeapon(){
  player.current=(player.current+1)%player.weapons.length;
}

// ========== PICKUPS ==========
function checkPickups(){
  for(let i=pickups.length-1;i>=0;i--){
    let p=pickups[i];
    let dx=p.x-player.x;
    let dy=p.y-player.y;
    if(Math.sqrt(dx*dx+dy*dy)<0.5){
      if(p.type=="ammo"){
        for(let w of player.weapons){ w.ammo+=10; }
      } else if(p.type=="health"){
        player.health=Math.min(player.health+30,100);
      }
      pickups.splice(i,1);
    }
  }
}

// ========== ENEMY AI ==========
function enemyAI(){
  for(let e of enemies){
    let dx=player.x-e.x;
    let dy=player.y-e.y;
    let dist=Math.sqrt(dx*dx+dy*dy);
    if(dist<0.5){ player.health-=0.5; }
    let angle=Math.atan2(dy,dx);
    if(dist>0.5){
      let nx=e.x+Math.cos(angle)*0.01;
      let ny=e.y+Math.sin(angle)*0.01;
      if(map[Math.floor(ny)][Math.floor(nx)]!="1"){ e.x=nx; e.y=ny; }
    }
  }
}

// ========== CONTROLS ==========
document.getElementById("shoot").ontouchstart=shoot;
document.getElementById("forward").ontouchstart=moveForward;
document.getElementById("left").ontouchstart=()=>{player.angle-=0.1};
document.getElementById("right").ontouchstart=()=>{player.angle+=0.1};
document.getElementById("switch").ontouchstart=switchWeapon;

// ========== MAIN LOOP ==========
function loop(){
  checkPickups();
  enemyAI();
  draw();
  requestAnimationFrame(loop);
}
loop();
</script>
</body>
</html>
