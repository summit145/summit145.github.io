<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Sledders 2D â€“ Ultimate Pixel Freeride</title>
<style>
html, body {
  margin: 0;
  background: #0b1622;
  overflow: hidden;
}
canvas {
  display: block;
  margin: auto;
  image-rendering: pixelated;
}
</style>
</head>
<body>
<canvas id="game" width="320" height="180"></canvas>

<script>
/* ================= CONFIG ================= */
const SCALE = 4;
const canvas = document.getElementById("game");
canvas.style.width = canvas.width * SCALE + "px";
canvas.style.height = canvas.height * SCALE + "px";
const ctx = canvas.getContext("2d");

const WORLD = 6000;
const camera = { x: 0, y: 0 };
let timeOfDay = 0;
const keys = {};
onkeydown = e => keys[e.key] = true;
onkeyup = e => keys[e.key] = false;

/* ================= PLAYER ================= */
const player = {
  x: WORLD/2, y: WORLD/2,
  angle: 0, speed: 0,
  lean: 0, width: 8, height: 12
};

/* ================= TERRAIN ================= */
const trees = [];
const hills = [];
const tracks = [];
const powder = [];
const snowDrift = [];
const snowflakes = [];

/* ================= GENERATE TREES & HILLS ================= */
for(let i=0;i<900;i++){
  trees.push({
    x: Math.random()*WORLD,
    y: Math.random()*WORLD,
    h: Math.floor(Math.random()*6 + 6),
    color: `rgb(${30+Math.random()*50}, ${80+Math.random()*60}, ${20+Math.random()*40})`,
    snowCap: Math.random()<0.5
  });
}
trees.sort((a,b)=>a.y-b.y);

for(let i=0;i<450;i++){
  hills.push({
    x: Math.random()*WORLD,
    y: Math.random()*WORLD,
    r: 160,
    h: Math.random()*2 - 1,
    shade: Math.random()*0.2 + 0.1
  });
}

/* ================= GENERATE SNOW DRIFT ================= */
for(let i=0;i<300;i++){
  snowDrift.push({
    x: Math.random()*WORLD,
    y: Math.random()*WORLD,
    dx: (Math.random()*0.1-0.05),
    dy: (Math.random()*0.1-0.05),
    alpha: 0.6 + Math.random()*0.3
  });
}

/* ================= GENERATE FALLING SNOW ================= */
for(let i=0;i<200;i++){
  snowflakes.push({
    x: Math.random()*canvas.width,
    y: Math.random()*canvas.height,
    dy: 0.2 + Math.random()*0.3,
    dx: (Math.random()*0.2-0.1),
    size: 1 + Math.random()*1
  });
}

/* ================= UPDATE ================= */
function update(){
  timeOfDay += 0.0003;

  if(keys["w"] || keys["ArrowUp"]) player.speed += 0.14;
  if(keys["s"] || keys["ArrowDown"]) player.speed *= 0.95;
  if(keys["a"] || keys["ArrowLeft"]) player.angle -= 0.045;
  if(keys["d"] || keys["ArrowRight"]) player.angle += 0.045;

  player.speed *= 0.985;
  player.speed = Math.max(Math.min(player.speed,4.8),-2);

  // Hills affect speed
  hills.forEach(h=>{
    let d = Math.hypot(player.x - h.x, player.y - h.y);
    if(d < h.r) player.speed += h.h*0.02;
  });

  // Player movement
  player.x += Math.cos(player.angle)*player.speed;
  player.y += Math.sin(player.angle)*player.speed;

  // Bounds
  player.x = Math.max(0, Math.min(WORLD, player.x));
  player.y = Math.max(0, Math.min(WORLD, player.y));

  player.lean = Math.sin(player.angle)*0.5;

  // Tracks & powder
  if(Math.abs(player.speed)>1){
    tracks.push({x:player.x, y:player.y, l:120});
    powder.push({
      x: player.x,
      y: player.y,
      dx: -Math.cos(player.angle)*0.3,
      dy: -Math.sin(player.angle)*0.3,
      l: 30
    });
  }

  tracks.forEach(t=>t.l--);
  powder.forEach(p=>{
    p.x += p.dx; p.y += p.dy; p.l--;
  });

  tracks.splice(0, tracks.filter(t=>t.l<=0).length);
  powder.splice(0, powder.filter(p=>p.l<=0).length);

  // Snow drift movement
  snowDrift.forEach(s=>{
    s.x += s.dx; s.y += s.dy;
    if(s.x<0) s.x=WORLD; if(s.x>WORLD) s.x=0;
    if(s.y<0) s.y=WORLD; if(s.y>WORLD) s.y=0;
  });

  // Snowflakes falling
  snowflakes.forEach(f=>{
    f.x += f.dx;
    f.y += f.dy;
    if(f.y>canvas.height) f.y=0;
    if(f.x<0) f.x=canvas.width;
    if(f.x>canvas.width) f.x=0;
  });

  // Smooth camera with look-ahead
  const lookAhead = 20 + player.speed*2;
  camera.x += ((player.x - canvas.width/2 + Math.cos(player.angle)*lookAhead) - camera.x)*0.1;
  camera.y += ((player.y - canvas.height/2 + Math.sin(player.angle)*lookAhead) - camera.y)*0.1;
}

/* ================= DRAW ================= */
function draw(){
  const night = (Math.sin(timeOfDay)+1)/2;

  // Background
  ctx.fillStyle = night>0.5?"#eaf6ff":"#bcd1e8";
  ctx.fillRect(0,0,canvas.width,canvas.height);

  // Hills with elevation contour effect
  hills.forEach(h=>{
    let x = h.x - camera.x;
    let y = h.y - camera.y;
    if(x>-200 && y>-200 && x<canvas.width+200){
      const gradient = ctx.createRadialGradient(x,y,0,x,y,h.r);
      const light = 200 + h.h*20;
      gradient.addColorStop(0, `rgba(${light},${light},255,${h.shade})`);
      gradient.addColorStop(0.7, `rgba(${light-30},${light-30},230,0.1)`);
      gradient.addColorStop(1, 'rgba(0,0,0,0)');
      ctx.fillStyle = gradient;
      ctx.beginPath();
      ctx.arc(x,y,h.r,0,Math.PI*2);
      ctx.fill();
    }
  });

  // Tracks (hardpack)
  ctx.fillStyle="rgba(180,190,200,0.8)";
  tracks.forEach(t=>ctx.fillRect(t.x-camera.x,t.y-camera.y,1,1));

  // Powder clouds
  ctx.fillStyle="rgba(255,255,255,0.9)";
  powder.forEach(p=>ctx.fillRect(p.x-camera.x,p.y-camera.y,1,1));

  // Snow drift (wind effect)
  ctx.fillStyle="rgba(255,255,255,0.6)";
  snowDrift.forEach(s=>ctx.fillRect(s.x-camera.x,s.y-camera.y,1,1));

  // Trees with snow caps
  trees.forEach(t=>{
    let x = t.x - camera.x;
    let y = t.y - camera.y;
    if(x>-20 && y>-40 && x<canvas.width+20){
      ctx.fillStyle="rgba(0,0,0,0.35)";
      ctx.fillRect(x+2,y+6,6,3);
      ctx.fillStyle="#5a3b1a";
      ctx.fillRect(x+3,y+4,2,t.h);
      ctx.fillStyle=t.color;
      ctx.beginPath();
      ctx.moveTo(x-2,y+4);
      ctx.lineTo(x+6,y+4);
      ctx.lineTo(x+2,y-4);
      ctx.closePath();
      ctx.fill();
      if(t.snowCap){
        ctx.fillStyle="rgba(255,255,255,0.7)";
        ctx.fillRect(x,y-4,4,2);
      }
    }
  });

  // Headlight cone
  ctx.save();
  ctx.translate(canvas.width/2, canvas.height/2);
  ctx.rotate(player.angle);
  ctx.fillStyle="rgba(255,255,200,0.15)";
  ctx.beginPath();
  ctx.moveTo(0,0);
  ctx.lineTo(50, -25);
  ctx.lineTo(50, 25);
  ctx.closePath();
  ctx.fill();
  ctx.restore();

  // Snowmobile
  ctx.save();
  ctx.translate(canvas.width/2, canvas.height/2);
  ctx.rotate(player.angle);
  ctx.fillStyle="#333333"; ctx.fillRect(-4,-5,2,10);
  ctx.fillRect(2,-5,2,10);
  ctx.fillStyle="#c40000"; ctx.fillRect(-3,-4,6,8);
  ctx.fillStyle="#222222"; ctx.fillRect(-2,-2,4,4);
  ctx.fillStyle="#555555"; ctx.fillRect(-4,-6,8,2);
  ctx.restore();

  // Mini-map
  ctx.fillStyle="#000000aa";
  ctx.fillRect(canvas.width-42,2,40,40);
  ctx.fillStyle="#fff";
  ctx.fillRect(canvas.width-42 + (player.x/WORLD)*40, 2 + (player.y/WORLD)*40, 2,2);

  // Snowflakes falling
  ctx.fillStyle="rgba(255,255,255,0.9)";
  snowflakes.forEach(f=>ctx.fillRect(f.x,f.y,f.size,f.size));

  // Night overlay
  if(night<0.4){
    ctx.fillStyle="rgba(0,20,40,0.25)";
    ctx.fillRect(0,0,canvas.width,canvas.height);
  }
}

/* ================= LOOP ================= */
function loop(){
  update();
  draw();
  requestAnimationFrame(loop);
}
loop();
</script>
</body>
</html>
